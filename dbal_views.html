---
layout: base
title: Guide
---

<p>Prerequisites : <a href="dbal_introspection.html">database introspection</a>.</p>

<h2>Views</h2>

<p>The library supports a basic kind of views.</p>

<h3>The problem</h3>

<p>Suppose you have an application that requires a User(login, password) table. But what you have in the database is a Person(name, password) table, a legacy table that you can't afford to refactor. Views offer a solution to this problem. By defining a User view you can turn the results of these queries :</p>

{% highlight php %}
<?php
  
  use Glue\DB\DB;
  
  // Returns data about the column 'login' of the database table 'User'
  $col_data = DB::table('User')->column('login');
  
  // Returns "SELECT `User`.`login` FROM `User`"
  $sql = DB::select('User', $m)->columns($m->login)->root()->sql();
  
?>
{% endhighlight %}

<p>...into this :</p>

{% highlight php %}
<?php
  
  use Glue\DB\DB;
  
  // Returns data about the column 'name' of the database table 'Person'
  $col_data = DB::table('User')->column('login');
  
  // Returns "SELECT `Person`.`name` FROM `Person`"
  $sql = DB::select('User', $m)->columns($m->login)->root()->sql();
  
?>
{% endhighlight %}

<h3>The solution</h3>

<p>Views are special <span class="inline_code">\Glue\DB\Table</span> objects. They behave just like tables, they show up in the introspection API and can be used in queries just the same. They have names and columns. However, unlike normal table objects, they are mapped to an underlying database table that may have a different name and different columns. That mapping is defined by creating a class that extends <span class="inline_code">\Glue\DB\Table</span> :</p>

{% highlight php %}
<?php
  // File classes/user/db/foo/bar.php
  
  namespace Glue\User\DB;
  
  class Table_User extends \Glue\DB\Table {
    
    // Override real table name :
    protected function init_name() {
      return 'Person';
    }
    
    // Override column alias for 'name' :
    public function get_column_alias(\Glue\DB\Column $column) {
      if ($column->name() === 'name')
        return 'login';
      return parent::get_column_alias($column);
    }
  }
?>
{% endhighlight %}

<p>The name of the class tells the library that the view is named 'User'. Overriding the init_name() function tells the library the underlying table is Person and overriding get_column_alias sets up the alias for the name column.</p>

