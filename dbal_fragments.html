---
layout: base
title: Guide
---

<h2>Query building</h2>

<p>A query builder makes it possible to write queries as a sequence of function calls rather than by string manipulation. Such a system comes in handy if you want : </p>

<ul>
  <li>Database independance : you want your application to be portable across various database backends.</li>
  <li>Dynamic queries : you need queries that are assembled at runtime according to some logic.</li>
</ul>

<h2>Fragments</h2>

<p>Queries are represented as trees of objects called <b>fragments</b>.

<p>There is a fragment class for each piece that makes up an SQL query, for example boolean expressions, boolean operands, join expressions, order by clause and so on. All fragment classes inherit from <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">\Glue\DB\Fragment</span></a> which means that they all share some common attributes :</p>

<ul>
  <li><b>A <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">public function sql(Connection $cn = null)</span></a> function </b>: calling this function returns the compiled form of the data structure, i.e. an SQL string formatted according to the SQL dialect of the given database connection.</li>
  <li><b>A <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">protected $users</span></a> property </b>: this is the list of all fragments that depend on (that "use") the current one to generated their own SQL. For example a boolean expression depends on its boolean operands so it is registered as a use in every one of them.</li>
  <li><b>A <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">protected $sql</span></a> property </b>: this is a cache to avoid compiling the fragment again and again each time the sql() function is called. The cache is invalidated everytime a property is modified and the cache invalidation process is cascaded to the users of the fragment.</li>
  <li><b>A <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">protected $context</span></a> property </b>: parent of the fragment in the query tree.</li>
</ul>










