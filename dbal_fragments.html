---
layout: base
title: Guide
---

<p>This page explains some of the inner workings of the library. You may skip it if you just want to get to the point.</p>

<h2>Fragments</h2>

<p>Queries are represented internally as <b>trees</b> of objects. A query tree is made up of nodes and branches :</p>

<ul>
  <li>Nodes are <b>fragments</b> : a fragment is an object that holds data about a specific piece of SQL query that can be compiled into an SQL string.</li>
  <li>Branches are <b>dependencies</b> between fragments : they represent the fact that the SQL string generated by a parent fragment incorporates the SQL strings generated by its children fragments.</li>
</ul>

<p>The following example build of tree of four fragments. The root is a boolean expression, and the children are boolean operands.</p>

{% highlight php %}
<?php
  // A fragment that represents a boolean expression.
  use \Glue\DB\Fragment_Builder_Bool;
  
  // Creates new fragment representing a boolean expression.
	$fragment = new Fragment_Builder_Bool();
  
  // Builds boolean expression.
  $fragment->init('1=1')  // Adds child fragment representig a boolean operand (Fragment_Operand_Bool).
           ->and('2=2')   // Adds child fragment representig a boolean operand with AND connector.
           ->or('3=3');   // Adds child fragment representig a boolean operand with OR connector.
  
  // Returns compiled SQL according to default connection SQL dialect
  $sql = $fragment->sql();
  
  // prints "1=1 AND 2=2 OR 3=3"
  echo $sql;
?>
{% endhighlight %}

<h2>Fragment classes</h2>

<p>There is a fragment class for each piece that makes up an SQL query, for example boolean expressions, boolean operands, join expressions, order by clause and so on. All fragment classes inherit from <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">\Glue\DB\Fragment</span></a> which means that they all share some common attributes :</p>

<ul>
  <li><b>A <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">public function sql(Connection $cn = null)</span></a> function </b>: calling this function returns the compiled form of the data structure, i.e. an SQL string formatted according to the SQL dialect of the given database connection.</li>
  <li><b>A <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">protected $users</span></a> property </b>: this is the list of all fragments that depend on (that "use") the current one to generated their own SQL. For example a boolean expression depends on its boolean operands so it is registered as a use in every one of them.</li>
  <li><b>A <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">protected $sql</span></a> property </b>: this is a cache to avoid compiling the fragment again and again each time the sql() function is called. The cache is invalidated everytime a property is modified and the cache invalidation process is cascaded to the users of the fragment.</li>
  <li><b>A <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">protected $context</span></a> property </b>: parent of the fragment in the query tree.</li>
</ul>










---
layout: base
title: Guide
---

<p>You may skip this page if you just want to get to the point.</p>

<h2>Fragments</h2>

<p>Queries are represented as trees of <b>fragments</b>.</p>

<p>A fragment is an object that represents a specific piece of an SQL query that can be compiled into an SQL string. For example :</p>

{% highlight php %}
<?php
  // A fragment that represents a boolean expression.
  use \Glue\DB\Fragment_Builder_Bool;
  
  // Creates new fragment representing a boolean expression.
	$fragment = new Fragment_Builder_Bool();
  
  $fragment->init('1=1')
           ->and('2=2')
           ->or('3=3');  // Builds boolean expression
           
  $sql = $fragment->sql();                        // Returns compiled SQL according to default connection SQL dialect
  
  echo $sql;                                      // prints "1=1 AND 2=2 OR 3=3"
?>
{% endhighlight %}

<p>There is a fragment class for each piece that makes up an SQL query, for example boolean expressions, boolean operands, join expressions, order by clause and so on. All fragment classes inherit from <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">\Glue\DB\Fragment</span></a> which means that they all share some common attributes :</p>

<ul>
  <li><b>A <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">public function sql(Connection $cn = null)</span></a> function </b>: calling this function returns the compiled form of the data structure, i.e. an SQL string formatted according to the SQL dialect of the given database connection.</li>
  <li><b>A <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">protected $users</span></a> property </b>: this is the list of all fragments that depend on (that "use") the current one to generated their own SQL. For example a boolean expression depends on its boolean operands so it is registered as a use in every one of them.</li>
  <li><b>A <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">protected $sql</span></a> property </b>: this is a cache to avoid compiling the fragment again and again each time the sql() function is called. The cache is invalidated everytime a property is modified and the cache invalidation process is cascaded to the users of the fragment.</li>
  <li><b>A <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">protected $context</span></a> property </b>: parent of the fragment in the query tree.</li>
</ul>










---
layout: base
title: Guide
---

<p>You may skip this page if you just want to get to the point.</p>

<h2>Fragments</h2>

<p>Queries are represented as trees of <b>fragments</b>.</p>

<p>A fragment is an object that represents a specific piece of an SQL query that can be compiled into an SQL string. For example :</p>

{% highlight php %}
<?php
  // A fragment that represents a boolean expression.
  use \Glue\DB\Fragment_Builder_Bool;
  
  // Creates new fragment representing a boolean expression.
	$fragment = new Fragment_Builder_Bool();
  
  $fragment->init('1=1')
           ->and('2=2')
           ->or('3=3');  // Builds boolean expression
           
  $sql = $fragment->sql();                        // Returns compiled SQL according to default connection SQL dialect
  
  echo $sql;                                      // prints "1=1 AND 2=2 OR 3=3"
?>
{% endhighlight %}

<p>There is a fragment class for each piece that makes up an SQL query, for example boolean expressions, boolean operands, join expressions, order by clause and so on. All fragment classes inherit from <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">\Glue\DB\Fragment</span></a> which means that they all share some common attributes :</p>

<ul>
  <li><b>A <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">public function sql(Connection $cn = null)</span></a> function </b>: calling this function returns the compiled form of the data structure, i.e. an SQL string formatted according to the SQL dialect of the given database connection.</li>
  <li><b>A <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">protected $users</span></a> property </b>: this is the list of all fragments that depend on (that "use") the current one to generated their own SQL. For example a boolean expression depends on its boolean operands so it is registered as a use in every one of them.</li>
  <li><b>A <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">protected $sql</span></a> property </b>: this is a cache to avoid compiling the fragment again and again each time the sql() function is called. The cache is invalidated everytime a property is modified and the cache invalidation process is cascaded to the users of the fragment.</li>
  <li><b>A <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment.php"><span class="inline_code">protected $context</span></a> property </b>: parent of the fragment in the query tree.</li>
</ul>










