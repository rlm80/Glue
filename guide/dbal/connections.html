---
layout: base
title: Guide
---

<p>Prerequisites : <a href="/Glue/guide/file_system.html#create_new_class">creating a new user class</a>.</p>

<h2>Database connections</h2>

<p>A connection object is a PDO instance connected to a specific database. Connections expand on the existing <a class="external" href="http://www.php.net/manual/en/class.pdo.php">PDO API</a> and provide a unified API for database introspection and functions to generate RDBMS specific SQL.</p>

<h3>Connection classes</h3>

<p>The library comes with three connection classes that extend PDO : <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/connection/mysql.php"><span class="inline_code">\Glue\DB\Connection_MySQL</span></a>, <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/connection/postgresql.php"><span class="inline_code">\Glue\DB\Connection_PostgreSQL</span></a> and <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/connection/sqlite.php"><span class="inline_code">\Glue\DB\Connection_SQLite</span></a>. Each of them has specific properties that define the required parameters to connect to the database it is designed to work with :</p>

<p>Common to all connection classes.</p>
<ul>
  <li><span class="inline_code">$username</span> : username used to connect to the database (default : 'root').</li>
  <li><span class="inline_code">$password</span> : password used to connect to the database (default : '').</li>
  <li><span class="inline_code">$charset</span> : connection charset (default : 'utf8').</li>
  <li><span class="inline_code">$options</span> : options array passed to PDO constructor (default : null).</li>
</ul>

<p>MySQL and PostgreSQL.</p>
<ul>
  <li><span class="inline_code">$host</span> : host of the database server (default : 'localhost').</li>
  <li><span class="inline_code">$port</span> : port of the database server (default : null).</li>
  <li><span class="inline_code">$dbname</span> : name of the database (default : null).</li>
</ul>

<p>SQLite.</p>
<ul>
  <li><span class="inline_code">$path</span> : path to sqlite file (default : null).</li>
</ul>

<h3>Defining database connections</h3>

<p>A database connection is defined by creating a new user class that extends either <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/connection/mysql.php"><span class="inline_code">\Glue\DB\Connection_MySQL</span></a>, <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/connection/postgresql.php"><span class="inline_code">\Glue\DB\Connection_PostgreSQL</span></a> or <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/connection/sqlite.php"><span class="inline_code">\Glue\DB\Connection_SQLite</span></a>. You must create one connection class by database connection. The name of the connection class must be of the form <span class="inline_code">Connection_&lt;id&gt;</span>, where &lt;id&gt; is a <b>connection identifier</b> of your own choosing.</p>

<p>Connection identifiers cannot contain underscores and at least one connection must have an identifier called <span class="inline_code">default</span>. That is, a <span class="inline_code">Connection_Default</span> class must exist.</p>

<p>Suppose you want to work with two database connections : your main database (SQLite) and a database with a forum (MySQL). You would create two classes :</p>

{% highlight php %}
<?php  
  // File classes/user/db/connection/default.php

  namespace Glue\User\DB;

  // Connection 'default'
  class Connection_Default extends \Glue\DB\Connection_SQLite {
    protected $path = 'my/sqlite/database.sqlite';
  }  
?>
{% endhighlight %}

{% highlight php %}
<?php
  // File classes/user/db/connection/forum.php

  namespace Glue\User\DB;

  // Connection 'forum'
  class Connection_Forum extends \Glue\DB\Connection_MySQL {
    protected $username = 'myusername';
    protected $password = 'mypassword';
    protected $dbname   = 'mydb';
  }
?>
{% endhighlight %}

<p>If the properties must be initialized with something more complicated than a constant, you may instead redefine the functions that compute the default values of properties :</p>

{% highlight php %}
<?php
  // File classes/user/db/connection/forum.php

  namespace Glue\User\DB;

  class Connection_Forum extends \Glue\DB\Connection_MySQL {
    protected function default_username() { return 'my' . 'username'; }
    protected function default_password() { return 'my' . 'password'; }
    protected function default_dbname()   { return 'my' . 'db'; }
  }
?>
{% endhighlight %}

<h3>Accessing database connections - connection identifiers</h3>

<p>To get connection instances, you must use the <span class="inline_code">DB::cn(&lt;connection identifier&gt;)</span> function. Connection instances are created upon first access, after that the same instance is always returned (i.e. connection objects behave as singletons). No parameter means default connection.</p>

{% highlight php %}
<?php
  use Glue\DB\DB;

  DB::cn('default')->exec("DELETE FROM mytable WHERE id = 10");
  
  // Is the same as :
  DB::cn()->exec("DELETE FROM mytable WHERE id = 10");
  
  // But not the same as :
  DB::cn('forum')->exec("DELETE FROM mytable WHERE id = 10");
?>
{% endhighlight %}













