---
layout: base
title: Guide
---

Prerequisites : <a href="dbal_connections.html">defining database connections</a>.

<h2>PDO introduction</h2>

<p>The <a class="external" href="http://php.net/manual/en/intro.pdo.php">PDO introduction page</a> states : "PDO provides a data-access abstraction layer, which means that, regardless of which database you're using, you use the same functions to issue queries and fetch data."</p>

<p>Database connection classes extend the <a class="external" href="http://www.php.net/manual/en/class.pdo.php">PDO class</a>. Everything that can be done with <a class="external" href="http://php.net/manual/en/book.pdo.php">PDO</a> can also be done with them. This page is a quick reminder of some of what you can do with PDO. The following explanation assumes that you have <a href="dbal_connections.html">defined</a> a default database connection.</p>

<h3>Statements that don't return a result set</h3>

<p>Statements that don't return a result set (insert, update, delete, create, drop...) can be performed using <a class="external" href="http://www.php.net/manual/en/pdo.exec.php">PDO::exec()</a>. It returns the number of affected rows. For insert statements on tables with an auto-incrementing primary key, you may use <a class="external" href="http://www.php.net/manual/en/pdo.lastinsertid.php">PDO::lastInsertId()</a> to get the first id inserted by the last statement on the current connection (so the range of ids inserted is [lastInsertId, lastInsertId + affected rows - 1]).</p>

{% highlight php %}
<?php
  use Glue\DB\DB;
  
  try {
    // Insert :
    $count  = DB::cn()->exec("INSERT INTO fruits (id, name, color)
                              VALUES (NULL, 'lemon','yellow'), (NULL, 'banana','red')");
    $lid    = DB::cn()->lastInsertId();
    
    // Update :
    $count  = DB::cn()->exec("UPDATE fruits SET color = 'yellow' WHERE color = 'red'");
    
    // Delete :
    $count  = DB::cn()->exec("DELETE FROM fruits WHERE color = 'yellow'");  
  }
  catch (PDOException $e) {
    echo $e->getMessage();
  }
?>
{% endhighlight %}

<h3>Statements that return a result set</h3>

<p>Statements that return a result set (select) can be performed using <a class="external" href="http://www.php.net/manual/en/pdo.query.php">PDO::query()</a>. It returns a <a class="external" href="http://www.php.net/manual/en/class.pdostatement.php">PDOStatement</a> object. PDOStatement instances are traversable, so you can loop over result sets using foreach :</p>

{% highlight php %}
<?php
  use Glue\DB\DB;
  
  try {
    $stmt = DB::cn()->query("SELECT id, name, color FROM fruits");
    
    foreach($stmt as $row)
      echo $row['id'] . ', ' . $row['name'] . ', ' . $row['color'] . "\n";
  }
  catch (PDOException $e) {
    echo $e->getMessage();
  }    
?>
{% endhighlight %}

<p>For the many other ways to fetch results, see <a class="external" href="http://www.php.net/manual/en/pdostatement.fetch.php">PDOStatement::fetch()</a>.</p>

<h3>Prepared statements</h3>

<p>For statements that need to be executed more than once, you should always use <a class="external" href="http://www.php.net/manual/en/pdo.prepared-statements.php">prepared statements</a>. A prepared statement is a statement with parameters that is sent once to the RDBMS for compiling, and then executed as many times as necessary with various parameter values. Since the statement only need to be compiled once, it's faster. Since PDO automatically quotes parameter values, it's safer.</p>

{% highlight php %}
<?php
  use Glue\DB\DB;
  
  try {
    $stmt = DB::cn()->prepare("INSERT INTO fruits VALUES (:name, :color)");
    
    $stmt->bindParam(':name',   $name);
    $stmt->bindParam(':color',  $color);
    
    $name = 'lemon';  $color = 'yellow';  $stmt->execute();
    $name = 'cherry'; $color = 'red';     $stmt->execute();
  }
  catch (PDOException $e) {
    echo $e->getMessage();
  }    
?>
{% endhighlight %}










