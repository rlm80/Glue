---
layout: base
title: Guide
---

<h2>Quick start guide</h2>

<p>This is a cookbook to get started quickly. Knowledge of the <a href="/Glue/guide/installation.html">Installation and usage</a> chapter is required.</p>

<h3>Entry point</h3>

<p>The entry point into everything DBAL-related is the static methods of the <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/db.php"><span class="inline_code">\Glue\DB\DB</span></a> class. It can be imported it into the current file like this :</p>

{% highlight php %}
<?php
  // Import the \Glue\DB\DB class, so that you can refer to it as simply "DB" (or "db") :
  use Glue\DB\DB;
    
  // Use static methods to do stuff :
  db::some_static_method();
?>
{% endhighlight %}

<h3>Database configuration</h3>

<p>Edit the following file and replace the connection parameters with your own :</p>

{% highlight php %}
<?php
  // File classes/user/db/connection/default.php
  
  namespace Glue\User\DB;

  class Connection_Default extends \Glue\DB\Connection_MySQL {
    protected $dbname   = 'test'; // Change this
    protected $username = 'root'; // Change this
    protected $password = '';     // Change this
  }
?>
{% endhighlight %}

<p>Calling <span class="inline_code">DB::cn()</span> will return a singleton instance of the default Connection class that was defined above :</p>

{% highlight php %}
<?php
  
  use Glue\DB\DB;
    
  $connection = db::cn();
?>
{% endhighlight %}

<p>For more information about defining database connections, refer to <a href="/Glue/guide/dbal/connections.html">Defining database connections</a>.</p>

<h3>Using a database connection</h3>

<p>Database connections are PDO instances connected to a database and must be used as such. Everything documented in the <a class="external" href="http://www.php.net/manual/en/book.pdo.php">PDO docs</a> applies here. If you have no idea what PDO is and how to use it, head over to <a href="/Glue/guide/dbal/pdo.html">PDO introduction</a>.</p>

<p>Example of how you may issue a simple query and display the results :</p>

{% highlight php %}
<?php
  // Import the \Glue\DB\DB class into the current file, so that you can refer to it as simply "DB" :
  use Glue\DB\DB;
  
  // Issue query :
  $results = DB::cn()->query("SELECT name FROM fruits");
  
  // Display results :
  foreach($results as $row)
    echo $row[0] . "<br>";
?>
{% endhighlight %}

<h3>Using the query builder</h3>

<p>Using the query builder to execute queries involves two steps :</p>

<ul>
  <li>building the query data structure,</li>
  <li>passing the data structure for execution/preparation to PDO, just as you would pass it any normal query string.</li>
</ul>

<p>An example of each type of query that may be built (select, insert, update and delete) follows. For more information about using the query builder, refer to <a href="/Glue/guide/dbal/query_builder/">Query builder</a> and subsequent chapters.</p>

<p>Please note that, except for the query building parts, everything else in the following snippets is standard PDO. Where you would usually pass an SQL string, you simply pass the query data structure instead.</p>

<h4>Select query</h4>

{% highlight php %}
<?php

  use Glue\DB\DB;

  // Build data stucture :
  $query = db::select('users', $u)
            ->left('profiles', $p)->on("$p->id = $u->id")
            ->where("$u->login = ?", 'Mike')
            ->columns($u->login, $p->email);
    
  // Pass query to PDO :
  $statement = db::cn()->query($query);
  
  // Fetch results :
  foreach($statement as $row) {
    $login = $row[$u->login];
    $email = $row[$p->email];
  }
?>
{% endhighlight %}

<h4>Insert query</h4>

{% highlight php %}
<?php

  use Glue\DB\DB;

  // Build data stucture :
  $query = db::insert('users')
            ->columns('login', 'password')
            ->values(array('Mike', 'qsdfazer'));
    
  // Pass query to PDO :
  $count          = db::cn()->exec($query);
  $last_insert_id = db::cn()->lastInsertId();
?>
{% endhighlight %}

<h4>Delete query</h4>

{% highlight php %}
<?php

  use Glue\DB\DB;

  // Build data stucture :
  $query = db::delete('users', $u)->where("$u->login = ?", 'mike');
    
  // Pass query to PDO :
  $count = db::cn()->exec($query);
?>
{% endhighlight %}

<h4>Update query</h4>

{% highlight php %}
<?php

  use Glue\DB\DB;

  // Build data stucture :
  $query = db::update('users', $u)
            ->set('password', '123456')
            ->where("$u->login = ?", 'mike');
    
  // Pass query to PDO :
  $count = db::cn()->exec($query);
?>
{% endhighlight %}

<h3>Using the database introspection API</h3>

<p>Example :</p>

{% highlight php %}
<?php
  
  use Glue\DB\DB;

  // Get the most appropriate PHP type to represent values
  // of column email of table 'profiles' on default connection :
  $phptype = db::cn()->table('profiles')->column('email')->phptype();  
  
  // List tables of default connection :
  $tables = DB::cn()->tables();
  foreach($tables as $table)
    echo $table->name() . '<br>';
    
  // List columns of table users :
  $columns = DB::cn()->table('users')->columns();
  foreach($columns as $column)
    echo $column->name() . '<br>';
?>
{% endhighlight %}

<p>For more information about using the introspection API, refer to <a href="/Glue/guide/dbal/introspection.html">Database introspection</a>.</p>

















