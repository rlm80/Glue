---
layout: base
title: Guide
---

<h2>Quick start guide</h2>

<p>This is a simple cookbook to get you started quickly. It assumes you're using a MySQL database and that you've read the <a href="/Glue/guide/installation.html">Installation and usage</a> chapter. For more explanations and details, refer to the rest of the guide.</p>

<h3>Database configuration</h3>

<p>Edit the following file and replace the connection parameters with your own :</p>

{% highlight php %}
<?php
  // File classes/user/db/connection/default.php
  
  namespace Glue\User\DB;

  class Connection_Default extends \Glue\DB\Connection_MySQL {
    protected $dbname   = 'test'; // Change this
    protected $username = 'root'; // Change this
    protected $password = '';     // Change this
  }
?>
{% endhighlight %}

<p>For more information about defining database connections, refer to <a href="/Glue/guide/dbal/connections.html">Defining database connections</a>.</p>

<h3>Using your database connection as a PDO instance</h3>

<p>The entry point into everything DBAL-related is the static methods of the <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/db.php"><span class="inline_code">\Glue\DB\DB</span></a> class. Calling <span class="inline_code">DB::cn()</span> will return a singleton instance of the Connection class that you defined above. You may use that object like you would use any other PDO instance, since that's what it actually is.</p>

<p>For example :</p>

{% highlight php %}
<?php
  // Import the \Glue\DB\DB class into the current file, so that you can refer to it as simply "DB" :
  use Glue\DB\DB;
    
  try {
    // Issue query :
    $statement = DB::cn()->query("SELECT name FROM fruits");
    
    // Display results :
    foreach($statement as $row)
      echo $row[0] . "\n";
  }
  catch (PDOException $e) {
    // Deal with errors :
    echo $e->getMessage();
  }
?>
{% endhighlight %}

<p>For more information about using PDO, refer to <a href="/Glue/guide/dbal/pdo.html">PDO introduction</a>.</p>

<h3>Using the query builder</h3>

<p>Using the query builder to execute queries involves two steps :</p>

<ul>
  <li>building the query data structure,</li>
  <li>passing the data structure for execution/preparation to PDO, just as you would pass it any normal query string.</li>
</ul>

<p>An example of each type of query that may be built (select, insert, update and delete) follows. To keep things simple, only a small range of the available methods are illustrated.</p>

<h4>Select query</h4>

{% highlight php %}
<?php

  use Glue\DB\DB;

  // Build data stucture :
  $query = db::select('users', $u)
            ->left('profiles', $p)->on("$p->id = $u->id")
            ->where("$u->login = ?", 'Mike')
            ->columns($u->login, $p->email);
    
  // Pass query to PDO :
  $statement = db::cn()->query($query);
  
  // Fetch results :
  foreach($statement as $row) {
    // Raw data (string) :
    $login = $row[$u->login];
    $email = $row[$p->email];
    
    // Type-casted data according to type of underlying db column :
    $login = $u->login($row); 
    $email = $p->email($row);
  }
?>
{% endhighlight %}

<h4>Insert query</h4>

{% highlight php %}
<?php

  use Glue\DB\DB;

  // Build data stucture :
  $query = db::insert('users')
            ->columns('login', 'password')
            ->values(array('Mike', 'qsdfazer'));
    
  // Pass query to PDO :
  $count          = db::cn()->exec($query);
  $last_insert_id = db::cn()->lastInsertId();
?>
{% endhighlight %}

<h4>Delete query</h4>

{% highlight php %}
<?php

  use Glue\DB\DB;

  // Build data stucture :
  $query = db::delete('users', $u)->where("$u->login = ?", 'mike');
    
  // Pass query to PDO :
  $count = db::cn()->exec($query);
?>
{% endhighlight %}

<h4>Update query</h4>

{% highlight php %}
<?php

  use Glue\DB\DB;

  // Build data stucture :
  $query = db::update('users', $u)
            ->set('password', '123456')
            ->where("$u->login = ?", 'mike');
    
  // Pass query to PDO :
  $count = db::cn()->exec($query);
?>
{% endhighlight %}



















