---
layout: base
title: Guide
---

<h2>Items and builders</h2>

<p>An SQL query is made up of lists of elements, of which there are 8 types :</p>

<ul>
  <li>boolean operands lists,</li>
  <li>join operands lists,</li>
  <li>order by lists,</li>
  <li>group by lists,</li>
  <li>select list,</li>
  <li>columns lists in an insert query,</li>
  <li>values lists in an insert query,</li>
  <li>assignements lists in an update query.</li>
</ul>

<p>Each of these lists is represented as a pair of fragments :</p>

<ul>
  <li>an item fragment : represents the elements that make up the list and provides getter/setters to access their data,</li>
  <li>a builder fragment : represents the list and provides a <a class="external" href="http://en.wikipedia.org/wiki/Method_chaining">fluent interface</a> to build it.</li>
</ul>

<p>Builder classes are located in the <a class="external" href="https://github.com/rlm80/Glue/tree/master/classes/system/db/fragment/builder"><span class="inline_code">classes/system/db/fragment/builder/</span></a> folder. They all extend the <a class="external" href="https://github.com/rlm80/Glue/tree/master/classes/system/db/fragment/builder.php"><span class="inline_code">\Glue\DB\Fragment_Builder</span></a> class and thus share some common methods :</p>

<ul>
  <li><span class="inline_code">->pop()</span> : removes last item,</li>
  <li><span class="inline_code">->reset()</span> : removes all items,</li>
  <li><span class="inline_code">->is_empty()</span> : whether the list is empty,</li>
  <li><span class="inline_code">->first()</span> : returns first item,</li>
  <li><span class="inline_code">->last()</span> : returns last item,</li>
  <li><span class="inline_code">->children()</span> : returns the items array by reference.</li>
</ul>

<p>The following sections look into each type of lists one by one, giving an example of how to use their builders.</p>

<h2>Boolean operands lists</h2>

<p>Builder : <a class="external" href="https://github.com/rlm80/Glue/tree/master/classes/system/db/fragment/builder/bool.php"><span class="inline_code">Fragment_Builder_Bool</span></a></p>

<p>Item : <a class="external" href="https://github.com/rlm80/Glue/tree/master/classes/system/db/fragment/item/bool.php"><span class="inline_code">Fragment_Item_Bool</span></a></p>

<p>Factory method : <span class="inline_code">DB::bool()</span></p>

<p>The builder has 4 methods :</p>

<ul>
  <li><span class="inline_code">->init()</span> : removes all items and initialize the expression with a first operand,</li>
  <li><span class="inline_code">->and()</span> : adds an operand, connecting it with AND,</li>
  <li><span class="inline_code">->or()</span> : adds an operand, connecting it with OR,</li>
  <li><span class="inline_code">->not()</span> : toggles negation of the expression.</li>
</ul>

<p>The methods <span class="inline_code">init()</span>, <span class="inline_code">and()</span> and <span class="inline_code">or()</span> take the same parameters as <span class="inline_code">DB::tpl()</span>, that is, a string of pseudo SQL, followed by a list of replacements. Alternatively, they also accept a single fragment parameter. The factory method is the same as creating a new builder and calling <span class="inline_code">init()</span>.</p>

{% highlight php %}
<?php

  use Glue\DB\DB;

  // Create fragment :
  $f = db::bool("`column` = ?", "test")->and("1=?", 1)->or("2=2");
  
  // Output SQL :
  echo db::cn()->compile( $f ); // ("column" = 'test') AND (1=1) OR (2=2)
  
  // Nested boolean expressions and negation :
  $f = db::bool("1=1")->and($nested = db::bool());
  $nested->init("2=2")->and("3=3")->not();
  
  // Output SQL :
  echo db::cn()->compile( $f ); // (1=1) AND NOT ((2=2) OR (3=3))
  
  // Other ways of writing the same boolean expression :
  $f = db::bool("1=1")->and( db::bool("2=2")->and("3=3")->not() );
  $f = db::bool("1=1 AND NOT ?", db::bool("2=2")->and("3=3") );
?>
{% endhighlight %}






























