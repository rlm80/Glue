---
layout: base
title: Guide
---

<h2>Template fragments</h2>

<p>Class : <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/fragment/template.php"><span class="inline_code">\Glue\DB\Fragment_Template</span></a></p>

<p>Factory : <span class="inline_code">DB::template()</span></a></p>

<p>Queries are represented as data structures so that they can be easily modified. However, there is little point in going as far as keeping track of the syntax tree of, say, an arithmetic expression. To cover such cases, template fragments are introduced.</p>

<p>Template fragments represent SQL templates to be included as-is in the query. The template may have '?' placeholders and you may supply a list of fragments to be used for replacements.</p>

<p>The SQL output of a template fragment is the template, where each placeholder has been replaced by the SQL output of each replacement fragment. If you supply constant values for replacements, they will be turned into Value fragments and thus quoted appropriately.</p> 

<h3>Interface</h3>

{% highlight php %}
<?php
  
  // Creation :
  $f = DB::template("1 < 5 + ?", 2);
  
  // API usage :
  $f->template();                 // Returns string "1 < 5 + ?"
  $f->template("1 < 6 + ?");      // Sets new template.
  $f->replacements();             // Return replacement array.
  $f->replacements(array(3));     // Sets replacement array.
  
  // Get SQL :
  echo $f->sql();                 // Prints "1 < 6 + 3"  
?>
{% endhighlight %}

<h3>Example 1 : constant replacements</h3>

{% highlight php %}
<?php
  
  // Template with placeholders and constant replacements :
  $tpl = DB::template("SUBSTR(?, 1, 3) IN ?", 'test', array('tes', 'tas', 'tos'));
  echo $tpl->sql(); // Prints "SUBSTR('test', 1, 3) IN ('tes','tas','tos')"
  
?>
{% endhighlight %}

<pre>
  +-- Template (SQL = "SUBSTR('test', 1, 3) IN ('tes','tas','tos')")
    +-- Value  (SQL = "'test'")
    +-- Value  (SQL = "('tes','tas','tos')")
</pre>

<h3>Example 2 : replacement fragments and subqueries</h3>

{% highlight php %}
<?php
  
  // Subquery :
  $tpl = DB::template("17 IN ?", 
      DB::select('users', $u)->columns($u->id)->where("$u->login LIKE ?",
        $param = DB::value()
      )
    );
  
  // Set parameter value and output SQL :
  $param->value('test%');
  echo $tpl->sql(); // Prints "17 IN (SELECT `users`.`id` FROM `users` WHERE `users`.`login` LIKE 'test%')";  
  
  // Set parameter value and output SQL :
  $param->value('toast%');
  echo $tpl->sql(); // Prints "17 IN (SELECT `users`.`id` FROM `users` WHERE `users`.`login` LIKE 'toast%')";    
?>
{% endhighlight %}

<pre>
  +-- Template (SQL = "17 IN (SELECT `users`.`id` FROM `users` WHERE `users`.`login` LIKE 'test%')")
    +-- Select query (SQL = "SELECT `users`.`id` FROM `users` WHERE `users`.`login` LIKE 'test%')")
      +-- Select list       (SQL = "`users`.`id`")
      +-- From clause       (SQL = "`users`")
      +-- Where clause      (SQL = "`users`.`login` LIKE 'test%'")
        +-- Boolean operand (SQL = "`users`.`login` LIKE 'test%'")
          +-- Template      (SQL = "`users`.`login` LIKE 'test%'")
            +-- Value       (SQL = "'test%'")    
</pre>

<h3>Example 3 : nested templates</h3>

{% highlight php %}
<?php
  
  // Template with placeholder for a query :
  $query = DB::select('users', $u)->where("$u->id ? 20", $tpl = DB::template()); 

  // Generate query with '<' operator :
  $tpl->template('<');
  echo $query->sql(); // Prints "SELECT * FROM `users` WHERE `users`.`id` < 20"
  
  // Generate query with '>=' operator :
  $tpl->template('>=');
  echo $query->sql(); // Prints "SELECT * FROM `users` WHERE `users`.`id` >= 20"   
?>
{% endhighlight %}

<h3>Boolean expressions</h3>

<h3>Alias fragments</h3>

<h3>Join expressions</h3>
























