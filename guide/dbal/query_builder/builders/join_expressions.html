---
layout: base
title: Guide
---

<h2>Join expressions</h2>

<p>Factory : <span class="inline_code">DB::join()</span></p>

<p>Represents a list of join operands, connected by join operators : <span class="inline_code">"table1" AS "alias1" LEFT OUTER JOIN "table2" AS "alias2" ON ...</span></p>

<h3>Items</h3>

<p>Class : <a class="external" href="https://github.com/rlm80/Glue/tree/master/classes/system/db/fragment/item/join.php"><span class="inline_code">Fragment_Item_Join</span></a></p>

<p>The item is an operator-operand pair and a boolean expression (ON clause). The operator can be either <span class="inline_code">DB::INNER</span>, <span class="inline_code">DB::LEFT</span>, <span class="inline_code">DB::RIGHT</span> or <span class="inline_code">DB::COMMA</span>. The operand can be any fragment. It has 3 methods :</p>

<ul>
  <li><span class="inline_code">->operator()</span> : operator getter/setter,</li>
  <li><span class="inline_code">->operand()</span> : operand getter/setter,</li>
  <li><span class="inline_code">->on()</span> : returns the on clause.</li>
</ul>

<h3>Builders</h3>

<p>Class : <a class="external" href="https://github.com/rlm80/Glue/tree/master/classes/system/db/fragment/builder/join.php"><span class="inline_code">Fragment_Builder_Join</span></a></p>

<p>There are 5 methods to add items to the list (all of them return <span class="inline_code">$this</span>) :</p>

<ul>
  <li><span class="inline_code">->init()</span> : removes all items and initialize the expression with a first item (no operator),</li>
  <li><span class="inline_code">->right()</span> : adds a new item with <span class="inline_code">DB::RIGHT</span> operator (no operator if list is still empty),</li>
  <li><span class="inline_code">->left()</span> : adds a new item with <span class="inline_code">DB::LEFT</span> operator (no operator if list is still empty),</li>
  <li><span class="inline_code">->inner()</span> : adds a new item with <span class="inline_code">DB::INNER</span> operator (no operator if list is still empty),</li>
  <li><span class="inline_code">->comma()</span> : adds a new item with <span class="inline_code">DB::COMMA</span> operator (no operator if list is still empty).</li>
</ul>

<p>These methods all take two parameters : </p>

<ol>
  <li>A table name, a table-alias array or any fragment.</li>
  <li>(optional) A variable passed by reference, to be filled with the table fragment defined by the first parameter.</li>
</ol>

<p>The 3 remaining methods operate on the ON clause of the last item (all of them return <span class="inline_code">$this</span>) :</p>

<ul>
  <li><span class="inline_code">->on()</span> : without parameters, returns the ON clause of the last item; otherwise forwards call to <span class="inline_code">->and()</span> method of the last ON clause.</li>
  <li><span class="inline_code">->and()</span> : forwards call to <span class="inline_code">->and()</span> method of the last ON clause,</li>
  <li><span class="inline_code">->or()</span> : forwards call to <span class="inline_code">->or()</span> method of the last ON clause.</li>
</ul>

<p>Calling the factory method is the same as creating a new builder and calling <span class="inline_code">init()</span>.</p>

<h3>Exemples</h3>

{% highlight php %}
<?php

  use Glue\DB\DB;

  // Create fragment :
  $f = db::join('users', $u)->left(array('profiles', 'myalias'), $p)->on("$p->id = $u->id");
  
  // Output SQL (assuming PostgreSQL default connection) :
  echo db::cn()->compile( $f );
  // "users" AS "users_0" LEFT OUTER JOIN "profiles" AS "myalias" ON ("myalias"."id" = "users_0"."id")
  
  // Nested joins expressions and negation :
  $f = db::join('t1', $t1)->left(
         db::join('t2', $t2)->inner('t3', $t3)->on("$t2->col = $t3->col + ?", 5)
       )->on("$t2->id = $t1->id")->or("$t3->id = $t1->id");
  
  // Output SQL (assuming MySQL default connection) :
  echo db::cn()->compile( $f );
  // `t1` AS `t1_0` LEFT OUTER JOIN (`t2` AS `t2_0` INNER JOIN `t3` AS `t3_0` ON (`t2_0`.`col` = `t3_0`.`col` + 5)) ON (`t2_0`.`id` = `t1_0`.`id`) OR (`t3_0`.`id` = `t1_0`.`id`)
?>
{% endhighlight %}