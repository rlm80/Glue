---
layout: base
title: Guide
---

<h2>Join expressions</h2>

<p>Factory method : <span class="inline_code">DB::join()</span></p>

<p>Represents a list of parentheses enclosed (TODO) join operands, connected by join operators : <span class="inline_code">TODO</span></p>

<h3>Items</h3>

<p>Item : <a class="external" href="https://github.com/rlm80/Glue/tree/master/classes/system/db/fragment/item/bool.php"><span class="inline_code">Fragment_Item_Join</span></a></p>

<p>The item is an operator-operand pair and a boolean expression (ON clause). The operator can be either <span class="inline_code">DB::INNER</span>, <span class="inline_code">DB::LEFT</span>, <span class="inline_code">DB::RIGHT</span> or <span class="inline_code">DB::COMMA</span>. The operand can be any fragment. It has 3 methods :</p>

<ul>
  <li><span class="inline_code">->operator()</span> : operator getter/setter,</li>
  <li><span class="inline_code">->operand()</span> : operand getter/setter,</li>
  <li><span class="inline_code">->on()</span> : returns the on clause.</li>
</ul>

<h3>Builders</h3>

<p>Builder : <a class="external" href="https://github.com/rlm80/Glue/tree/master/classes/system/db/fragment/builder/join.php"><span class="inline_code">Fragment_Builder_Join</span></a></p>

<p>The builder has 8 methods, all of them return <span class="inline_code">$this</span> :</p>

<ul>
  <li><span class="inline_code">->init()</span> : removes all items and initialize the expression with a first item (no operator),</li>
  <li><span class="inline_code">->right()</span> : adds a new item with RIGHT OUTER JOIN operator (no operator if list is still empty),</li>
  <li><span class="inline_code">->left()</span> : adds a new item with LEFT OUTER JOIN operator (no operator if list is still empty),</li>
  <li><span class="inline_code">->inner()</span> : adds a new item with INNER JOIN operator (no operator if list is still empty),</li>
  <li><span class="inline_code">->comma()</span> : adds a new item with ',' join operator (no operator if list is still empty),</li>
  <li><span class="inline_code">->on()</span> :
    <ul>
      <li>without parameters, returns the ON clause of the last item,</li>
      <li>with parameters, forwards call to <span class="inline_code">->and()</span> method of the ON clause of the last item.</li>
    </ul>
  </li>
  <li><span class="inline_code">->and()</span> : forwards call to <span class="inline_code">->and()</span> method of the ON clause of the last item,</li>
  <li><span class="inline_code">->or()</span> : forwards call to <span class="inline_code">->or()</span> method of the ON clause of the last item.</li>
</ul>

<p>Calling the factory method is the same as creating a new builder and calling <span class="inline_code">init()</span>. The methods <span class="inline_code">init()</span>, <span class="inline_code">right()</span>, <span class="inline_code">left()</span>, <span class="inline_code">inner()</span> and <span class="inline_code">comma()</span> all take two parameters : </p>

<ol>
  <li>A table name, a (table name, table alias) array or any fragment.</li>
  <li>(optional) A variable passed by reference, to be filled with the operand of the join item. If a table name or a table-alias array was passed as first parameter, the operand is a table fragment.</li>
</ol>

<h3>Code samples</h3>

{% highlight php %}
<?php

  use Glue\DB\DB;

  // Create fragment :
  $f = db::join('users', $u)->left(array('profiles', 'myalias'), $p)->on("$p->id = $u->id");
  
  // Output SQL (assuming PostgreSQL default connection) :
  echo db::cn()->compile( $f );
  // "users" AS "users_0" LEFT OUTER JOIN "profiles" AS "myalias" ON ("myalias"."id" = "users_0"."id")
  
  // Nested joins expressions and negation :
  $f = db::join('t1', $t1)->left(
         db::join('t2', $t2)->inner('t3', $t3)->on("$t2->col = $t3->col + ?", 5)
       )->on("$t2->id = $t1->id")->or("$t3->id = $t1->id");
  
  // Output SQL (assuming MySQL default connection) :
  echo db::cn()->compile( $f );
  // `t1` AS `t1_0` LEFT OUTER JOIN (`t2` AS `t2_0` INNER JOIN `t3` AS `t3_0` ON (`t2_0`.`col` = `t3_0`.`col` + 5)) ON (`t2_0`.`id` = `t1_0`.`id`) OR (`t3_0`.`id` = `t1_0`.`id`)
?>
{% endhighlight %}