---
layout: base
title: Guide
---
<h2>Database introspection</h2>

<p>Database introspection refers to the means of retrieving database schema meta-data : table names, column names, column types and indexes.</p>

<h3>Table data</h3>

<p>Table data is represented as instances of the <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/table.php"><span class="inline_code">\Glue\DB\Table</span></a> class. These objects can be retrieved and used like this :</p>

{% highlight php %}
<?php
  
  use Glue\DB\DB;
  
  // Returns data about table 'mytable' of connection 'myconnection'
  $table = db::cn('myconnection')->table('mytable');
  
  // Available data about that table :
  $name     = $table->name();     // Name of the table
  $cn       = $table->cn();       // Connection
  $columns  = $table->columns();  // Columns array
  $pk       = $table->pk();       // Primary key columns array
  
?>
{% endhighlight %}

<h3>Column data</h3>

<p>Column data is stored in instances of the <a class="external" href="https://github.com/rlm80/Glue/blob/master/classes/system/db/column.php"><span class="inline_code">\Glue\DB\Column</span></a> class. These objects can be retrieved and used like this :</p>

{% highlight php %}
<?php
  
  use Glue\DB\DB;
  
  // Returns data about column 'mycolumn' of table 'mytable' of connection 'myconnection'
  $column = db::cn('myconnection')->table('mytable')->column('mycolumn');
  
  // Available data about that column :
  $name       = $column->name();       // Name of the column
  $type       = $column->type();       // Database type (as returned by RDBMS)
  $phptype    = $column->phptype();    // Most appropriate PHP type to represent column data    
  $nullable   = $column->nullable();   // Whether or not column is nullable
  $maxlength  = $column->maxlength();  // Max length for character columns
  $precision  = $column->precision();  // Decimal(6,2) ? => precision = 6
  $scale      = $column->scale();      // Decimal(6,2) ? => scale = 2
  $default    = $column->default();    // Default column value (string as returned by RDBMS)
  $auto       = $column->auto();       // Whether or not column is auto-incrementing
?>
{% endhighlight %}

<h3>Listing connections</h3>

{% highlight php %}
<?php
  
  use Glue\DB\DB;

  // List connections :
  $list         = db::connection_list(); // Returns array of connection ids indexed by ids
  $connections  = db::connections();     // Returns array of connection objects indexed by ids
  
  // Checking existence of a connection :
  $exists = db::connection_exists('myconnection');

?>
{% endhighlight %}

<h3>Listing tables</h3>

{% highlight php %}
<?php
  
  use Glue\DB\DB;

  // List tables of default connection :
  $list   = db::cn()->table_list(); // Returns array of table names indexed by names
  $tables = db::cn()->tables();     // Returns array of table objects indexed by names
  
  // Checking existence of a table :
  $exists = db::cn()->table_exists('mytable');

?>
{% endhighlight %}

<h3>Listing columns</h3>

{% highlight php %}
<?php
  
  use Glue\DB\DB;
  
  // Get table :
  $table = db::cn()->table('mytable'); 

  // List columns :
  $list     = $table->column_list(); // Returns array of column names indexed by names
  $columns  = $table->columns();     // Returns array of column objects indexed by names
  
  // Checking existence of a column :
  $exists = $table->column_exists('mycolumn');

?>
{% endhighlight %}

<h3>Caching</h3>

<p>During a page load, all of these column and table objects are created upon first request and then reused. That is :</p>

{% highlight php %}
<?php
  
  use Glue\DB\DB;
  
  $t1 = db::cn()->table('mytable');
  $t2 = db::cn()->table('mytable');
  
  var_dump($t1 === $t2); // TRUE
  
  $c1 = $t1->column('mycolumn');
  $c2 = $t2->column('mycolumn');
  
  var_dump($c1 === $c2); // TRUE  
?>
{% endhighlight %}

<p>Between each page load, all introspected data is cached on disk as serialized objects. If you change the database schema, you must clear the cache by deleting the cache directory. If not in production, you may also disable the introspection cache entirely.</p>
