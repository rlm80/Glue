---
layout: base
title: Guide
---
<h2>Database introspection</h2>

<p>Database introspection refers to the means of retrieving database schema meta-data : table names, column names, column types and indexes.</p>

<h3>Table data</h3>

<p>Table data is represented as instances of the <span class="inline_code">\Glue\DB\Table</span> class. These objects can be retrieved and used like this :</p>

{% highlight php %}
<?php
  
  use Glue\DB\DB;
  
  // Returns data about table 'mytable' of connection 'myconnection'
  $table = DB::cn('myconnection')->table('mytable');
  
  // Available data about that table :
  $name     = $table->name();     // Name
  $cn       = $table->cn();       // Connection
  $columns  = $table->columns();  // Columns array
  $pk       = $table->pk();       // Primary key columns array
  
?>
{% endhighlight %}

<h3>Column data</h3>

<p>Column data is stored in instances of the <span class="inline_code">\Glue\DB\Column</span> class. These objects can be retrieved and used like this :</p>

{% highlight php %}
<?php
  
  use Glue\DB\DB;
  
  // Returns data about column 'mycolumn' of table 'mytable' of connection 'myconnection'
  $column = DB::cn('myconnection')->table('mytable')->column('mycolumn');
  
  // Available data about that column :
  $name       = $column->name();        // Name
  $type       = $column->type()));      // Database type (as returned by RDBMS)
  $phptype    = $column->phptype());    // Most appropriate PHP type to store column data    
  $nullable   = $column->nullable());   // Whether or not column is nullable
  $maxlength  = $column->maxlength());  // Max length for character columns
  $precision  = $column->precision());  // Decimal(6,2) ? => precision = 6
  $scale      = $column->scale());      // Decimal(6,2) ? => scale = 2
  $default    = $column->default());    // Default column value (type casted according to php type)
  $auto       = $column->auto());       // Whether or not column is auto-incrementing
?>
{% endhighlight %}

<h3>Listing tables</h3>

{% highlight php %}
<?php
  
  use Glue\DB\DB;

  // List tables of default connection :
  $list   = DB::cn()->table_list(); // Returns array of table names indexed by names
  $tables = DB::cn()->tables();     // Returns array of table objects indexed by names
  
  // Checking existence of a table :
  $exists = DB::cn()->table_exists('mytable');

?>
{% endhighlight %}

<h3>Listing columns</h3>

{% highlight php %}
<?php
  
  use Glue\DB\DB;
  
  // Get table :
  $table = DB::cn()->table('mytable'); 

  // List columns :
  $list     = $table->column_list(); // Returns array of column names indexed by names
  $columns  = $table->columns();     // Returns array of column objects indexed by names
  
  // Checking existence of a column :
  $exists = $table->column_exists('mycolumn');

?>
{% endhighlight %}

<h3>Caching</h3>

<p>During a page load, all of these column and table objects are created upon first request and then reused. That is :</p>

{% highlight php %}
<?php
  
  use Glue\DB\DB;
  
  $t1 = DB::cn()->table('mytable');
  $t2 = DB::cn()->table('mytable');
  
  var_dump($t1 === $t2); // TRUE
  
  $c1 = $t1->column('mycolumn');
  $c2 = $t2->column('mycolumn');
  
  var_dump($c1 === $c2); // TRUE  
?>
{% endhighlight %}

<p>Between each page load, all introspected data is cached on disk as serialized <span class="inline_code">\Glue\DB\Table</span> objects. If you change the database schema, you must clear the cache by deleting the cache directory. If not in production, you may also disable the introspection cache entirely (see options).</p>
